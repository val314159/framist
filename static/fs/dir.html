<div>
  Path:<input id="path" value="hello.txt">
  <div>
    <button onclick="go_to('.')">List</button>
    <button onclick="savex()">Save</button>
    <button onclick="loadx()">Load</button>
  </div>
  <div id="edit" style="border:1px solid blue">EDIT</div>
</div>
<script>
function str(x){return JSON.stringify(x)}
function $E(x){return document.getElementById(x.substr(1))}
function $H(x){return $E(x).innerHTML} 
function $V(x){return $E(x).value} 
function $I(e,y){e.innerHTML=y;return e} 
function LOG(x){document.body.appendChild($I(document.createElement("li"),x))}
function APPEND(e,x){e.appendChild($I(document.createElement("li"),x))}
var ws = new WebSocket("ws://localhost:8383/ws/fs");
ws.onopen=function(e){
  LOG("OPN:"+e);
  loadx();
  LOG("OPN2:"+e);
}
function send(x){
  try{
    ws.send(x)
  } catch (e) {
    LOG("SEND ERR:"+e)
  }
}
function go_to(x){    
    LOG("Go To " +x);
    $E("#path").value = x;
    loadx();
}
ws.onmessage=function(x){
  LOG("MSG:"+x.data);
  m=JSON.parse(x.data);
  //LOG(m.result[1]);
  var text=m.result[1];
  var elt = $E(m.result[2]);
  if(typeof(text)=="string"){
    text = text.replace(/  /g,' &nbsp;');
    text = text.replace(/\n/g,'<br>');
    elt.innerHTML = text;
    elt.contentEditable=true;
  }else{
    elt.innerHTML = "";
    for (var n=0;n<text.length;n++) {
      var v=text[n][0];
      var v2=v;
      if (text[n][1])
	  v2 += '/';
      //LOG("<a href='/f?path="+v+"'>"+v+"</a>");
      var s = "<a xhref='/f?path="+v+"' onclick=go_to('"+v+"') >"+v2+"</a>";
      APPEND(elt,s);
    }
    elt.contentEditable=false;
  }
}
ws.onclose=function(x){  LOG("CLS:"+x); }
ws.onerror=function(x){  LOG("ERR:"+x); }

function fs_get(path,eltName){
  send(str({"method":"fs_get","params":[path,eltName]}))}
function fs_put(path,data){
  send(str({"method":"fs_put","params":[path,data]}))}
function savex(){
  var text = $H("#edit");
  text = text.replace(/\<\/div\>/g,'');
  text = text.replace(/\<div\>/g,'\n');
  text = text.replace(/\<br\>/g,'\n');
  text = text.replace(/&nbsp;/g,' ');
  fs_put($V("#path"),[text]); }
function loadx(){ fs_get($V("#path"),"#edit"); }
function listx(){ go_to('.'); }
//</script>
