<!doctype html>
<style>
.edit {
  background: yellow;
}
</style>
</head>
<body>
Filename:<input id="filename" value="hello.txt">
<div class=edit id=edit contentEditable="true">EDIT</div>
<div>
  <button onclick=savex()>Save</button>
  <button onclick=loadx()>Load</button>
</div>
<script>
function str(x){return JSON.stringify(x)}
function $E(x){return document.getElementById(x.substr(1))}
function $H(x){return $E(x).innerHTML} 
function $V(x){return $E(x).value} 
function $I(e,y){e.innerHTML=y;return e} 
function $T(x){return $E(x).textContent}  
function $TC(x){return $E(x).innerText}  
function LOG(x){document.body.appendChild($I(document.createElement("li"),x))}
var ws = new WebSocket("ws://localhost:8383/ws/fs");
ws.onopen=function(e){
  LOG("OPN:"+e);
  loadx();
  LOG("OPN2:"+e);
}
function send(x){
  try{
    LOG("- before send -");
    ws.send(x)
    LOG("- after send -");
  } catch (e) {
    LOG("SEND ERR:"+e)
  }
}
ws.onmessage=function(x){
  LOG("MSG:"+x.data);
  m=JSON.parse(x.data);
  LOG(m.result[1]);
  var text=m.result[1];
  LOG("text10:"+str(text));
  text = text.replace(/  /g,' &nbsp;');
  text = text.replace(/\n/g,'<br>');
  LOG("text11:"+str(text));
  $E(m.result[2]).innerHTML = text;
}
ws.onclose=function(x){ LOG("CLS:"+x); }
ws.onerror=function(x){ LOG("ERR:"+x); }

function fs_get(fname,eltName){
  send(str({"method":"fs_get","params":[fname,eltName]}))
}
function fs_put(fname,data){
  send(str({"method":"fs_put","params":[fname,data]}))
}

function savex(){
  var text = $H("#edit");
  LOG("text20:"+escape(text));
  text = text.replace(/\<\/div\>/g,'');
  text = text.replace(/\<div\>/g,'\n');
  text = text.replace(/\<br\>/g,'\n');
  text = text.replace(/&nbsp;/g,' ');
  LOG("text21:"+str(text));
  fs_put($V("#filename"),[text]); }
function loadx(){ fs_get($V("#filename"),"#edit"); }
//</script>
